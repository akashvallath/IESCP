{% extends 'layout.html' %}
{% block title %}Home{% endblock title %}
{% block body %}
<div class="navbar">
    <div>
        {% if influencer.profilepic %}
        {% set filename = influencer.username + influencer.file_extension %}
        <a style="display: inline;" class="no-hover" href="{{url_for('influencer_myprofile', id=influencer.id)}}"><img class="roundimage" src="{{url_for('static', filename='profilepics/' + filename)}}"></a>
        {% else %}
        <a style="display: inline;" class="no-hover" href="{{url_for('influencer_myprofile', id=influencer.id)}}"><img class="roundimage" src="https://api.dicebear.com/9.x/thumbs/svg?seed=Mimi"></a>
        {% endif %}
        <h6 style="display: inline;">{{ influencer.username }}</h6>
    </div>
    <a href="{{url_for('home')}}"><i class="fa-solid fa-house-user"></i> Home</a>
    <a href="{{ url_for('influencer_find_campaign', id=influencer.id )}}"><i class="fa-solid fa-magnifying-glass"></i> Campaigns</a>
    {% if 'username' in session %}
    <a href="{{url_for('logout')}}"><i class="fa-solid fa-right-to-bracket"></i> Logout</a>
    {% else %}
    <a href="{{url_for('login')}}"><i class="fa-solid fa-right-to-bracket"></i> Login</a>
    {% endif %}
</div>
{% include 'message.html' %}
<div class="content">
    <h3 style="margin-left: 10px; margin-bottom: 15px;">Welcome, {{influencer.username}}</h3>
    <div class="container" style="display: flex; background-color: rgb(148, 128, 216);">
        <div style="margin-left: 10px;">
            <h6>â†“My Campaigns </h6>
            <h2>{{ my_campaigns|length }}</h2>
        </div>
        <div style="margin-left: 77px;">
            <h6>â†“Campaign Requests </h6>
            <h2>{{ sponsor_requests|length }}</h2>
        </div>
        <div style="margin-left: 77px;">
            <h6>â†“My Pending Requests </h6>
            <h2>{{ pending_requests|length + negotiations|length }}</h2>
        </div>
        <div style="margin-left: 77px;">
            <h6>â†“Completed Campaigns </h6>
            <h2>{{ completed_campaigns|length }}</h2>
        </div>
        <div style="margin-left: 77px;">
            <h6>â†“Pending Payments </h6>
            <h2>{{ pending_payments|length }}</h2>
        </div>
    </div>
    <div class="container" style="margin-top: 10px;">
        <h4 style="margin-left: 10px; margin-bottom: 15px;">Latest Campaign's ðŸ˜€</h4>
        {% if latest_campaigns %}
        <table>
            <tr>
                <th>CAMPAIGN NAME</th>
                <th>SPONSOR</th>
                <th>TYPE</th>
                <th>START DATE</th>
                <th>END DATE</th>
                <th>BUDGET</th>
                <th>REQUEST</th>
            </tr>
        {% for campaign in latest_campaigns %}
            <tr>
                <td><a href="{{url_for('campaign', cmpid=campaign.id, infid=influencer.id)}}"><b>{{ campaign.name }}</b></a></td>
                <td><a href="{{url_for('sponsorprofileforinfluencer', id=influencer.id, sponsor_id=campaign.sponsor.id)}}"><b>{{ campaign.sponsor.username }}</b></a></td>
                <td>{{ campaign.typeofcampaign }}</td>
                <td>{{ campaign.created_on.strftime('%B %d, %Y') }}</td>
                <td>{{ campaign.deadline.strftime('%B %d, %Y') }}</td>
                <td><b>{{ campaign.budget }} â‚¹</b></td>
                <td><a href="{{url_for('influencer_request', campaign_id=campaign.id, influencer_id=influencer.id)}}"><b>Request</b></a></td>
            </tr>
        {% endfor %}
        </table>
        {% else %}
        <p style="margin-left: 10px;">No public campaigns are avilable now!<p>
        {% endif %}
    </div>
    <div class="container" style="margin-top: 20px;">
        <h4 style="margin-left: 10px;">My Ongoing campaign's ðŸ˜€</h4>
        {% if my_campaigns %}
        <table>
        <tr>
            <th>CAMPAIGN NAME</th>
            <th>SPONSOR</th>
            <th>TYPE</th>
            <th>START DATE</th>
            <th>BUDGET</th>
            <th>END DATE</th>
        </tr>
        {% for event in my_campaigns %}
        <tr>
            <td><a href="{{url_for('campaign', cmpid=event.campaign.id, infid=influencer.id)}}"><b>{{ event.campaign.name }}</b></a></td>
            <td><a href="{{url_for('sponsorprofileforinfluencer', id=influencer.id, sponsor_id=event.campaign.sponsor.id)}}"><b>{{ event.campaign.sponsor.username }}</b></a></td>
            <td>{{ event.campaign.typeofcampaign }}</td>
            <td>{{ event.campaign.created_on.strftime('%B %d, %Y') }}</td>
            <td><b>{{ event.budget }} â‚¹</b></td>
            <td>{{ event.campaign.deadline.strftime('%B %d, %Y') }}</td>
        </tr>
        {% endfor %}
        </table>
        {% else %}
        <p style="margin-left: 10px;">You haven't joined any campaign yet!<p>
        {% endif %}
    </div>
    {% if sponsor_requests %}
    <div class="container" style="margin-top: 20px;">
        <h4 style="margin-left: 10px;">Campaign Request's ðŸ˜€</h4>
        <table>
            <tr>
                <th>CAMPAIGN NAME</th>
                <th>SPONSOR</th>
                <th>TYPE</th>
                <th>START DATE</th>
                <th>END DATE</th>
                <th>BUDGET</th>
                <th>ACCEPT</th>
                <th>REJECT</th>
            </tr>
        {% for request in sponsor_requests %}
        <tr>
            <td><a href="{{url_for('campaign', cmpid=request.campaign.id, infid=influencer.id)}}"><b>{{ request.campaign.name }}</b></a></td>
            <td><a href="{{url_for('sponsorprofileforinfluencer', id=influencer.id, sponsor_id=request.campaign.sponsor.id)}}"><b>{{ request.campaign.sponsor.username }}</b></a></td>
            <td>{{ request.campaign.typeofcampaign }}</td>
            <td>{{ request.campaign.created_on.strftime('%B %d, %Y') }}</td>
            <td>{{ request.campaign.deadline.strftime('%B %d, %Y') }}</td>
            <td><b>{{ request.campaign.budget }} â‚¹</b></td>
            <td><a href="{{url_for('influencer_campaign_accept_reject', operation='accept',campaign_id=request.campaign.id,influencer_id=influencer.id,sponsor_id=request.campaign.sponsor.id)}}"><b>Accept</b></a></td>
            <td><a href="{{url_for('influencer_campaign_accept_reject', operation='reject',campaign_id=request.campaign.id,influencer_id=influencer.id,sponsor_id=request.campaign.sponsor.id)}}"><b>Reject</b></a></td>
        </tr>
        {% endfor %}
        </table>
    </div>
    {% endif %}
    {% if negotiations %}
    <div class="container" style="margin-top: 20px;">
        <h4 style="margin-left: 10px; margin-bottom: 15px;">Pending Negotiation</h4>
        <table>
        <tr>
            <th>CAMPAIGN NAME</th>
            <th>SPONSOR</th>
            <th>TYPE</th>
            <th>BUDGET</th>
            <th>NEGOTIATED BUDGET</th>
            <th>DELETE</th>
        </tr>
        {% for negotiate in negotiations %}
        <tr>
            <td><a href="{{url_for('campaign', cmpid=negotiate.campaign.id, infid=influencer.id)}}"><b>{{ negotiate.campaign.name }}</b></a></td>
            <td>{{ negotiate.sponsor.username }}</td>
            <td>{{ negotiate.campaign.typeofcampaign }}</td>
            <td>{{ negotiate.campaign.budget }}</td>
            <td>{{ negotiate.budget }}</td>
            <td><a href="{{url_for('deletenegotiation', id=influencer.id, campaign_id=negotiate.campaign.id)}}"><b>Delete</b></a></td>
        </tr>
        {% endfor %}
        </table>
    </div>
    {% endif %}
    {% if pending_requests %}
    <div class="container" style="margin-top: 20px;">
        <h4 style="margin-left: 10px;">My Request's ðŸ˜€</h4>
        <table>
        <tr>
            <th>CAMPAIGN NAME</th>
            <th>SPONSOR</th>
            <th>TYPE</th>
            <th>START DATE</th>
            <th>END DATE</th>
            <th>BUDGET</th>
            <th>DELETE</th>
        </tr>
        {% for request in pending_requests %}
        <tr>
            <td><a href="{{url_for('campaign', cmpid=request.campaign.id, infid=influencer.id)}}"><b>{{ request.campaign.name }}</b></a></td>
            <td><a href="{{url_for('sponsorprofileforinfluencer', id=influencer.id, sponsor_id=request.campaign.sponsor.id)}}"><b>{{ request.campaign.sponsor.companyname }}</b></a></td>
            <td>{{ request.campaign.typeofcampaign }}</td>
            <td>{{ request.campaign.created_on.strftime('%B %d, %Y') }}</td>
            <td>{{ request.campaign.deadline.strftime('%B %d, %Y') }}</td>
            <td><b>{{ request.campaign.budget }} â‚¹</b></td>
            <td><a href="{{url_for('influencer_delete_request', id=request.influencer.id, campaign_id=request.campaign.id)}}"><b>Delete</b></a></td>
        </tr>
        {% endfor %}
        </table>
    </div>
    {% endif %}
</div>
{% include 'footer.html' %}
{% endblock body %}
{% block script%}
{% endblock script %}